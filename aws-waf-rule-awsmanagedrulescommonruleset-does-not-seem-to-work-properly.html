<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="I'm currently trying to setup a Cloudfront distribution with a web ACL (WAF). I enabled the AWS managed rule called AWSManagedRulesCommonRuleSet (documentation to this rule can be found here: https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-baseline.html)."><meta name=author content="Martina Birk"><meta name=generator content="Hugo 0.98.0"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=robots content="index,follow,noarchive"><link rel=stylesheet href=https://assets.cdnweb.info/hugo/base16/css/style.css type=text/css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type=text/css><link rel=alternate href=./index.xml type=application/rss+xml title=JadeVlog><title>AWS WAF rule AWSManagedRulesCommonRuleSet does not seem to work properly - JadeVlog</title></head><body><header><div class="container clearfix"><a class=path href=./index.html>[JadeVlog]</a>
<span class=caret># _</span><div class=right></div></div></header><div class=container><main role=main class=article><article class=single itemscope itemtype=http://schema.org/BlogPosting><div class=meta><span class=key>published on</span>
<span class=val><time itemprop=datePublished datetime=2024-09-16>September 16, 2024</time></span>
<span class=key>in</span>
<span class=val><a href=./categories/blog>blog</a></span></div><h1 class=headline itemprop=headline>AWS WAF rule AWSManagedRulesCommonRuleSet does not seem to work properly</h1><section class=body itemprop=articleBody><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>I'm currently trying to setup a Cloudfront distribution with a web ACL (WAF). I enabled the AWS managed rule called <code>AWSManagedRulesCommonRuleSet</code> (documentation to this rule can be found here: <a href=# rel="nofollow noreferrer">https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-baseline.html</a>).</p><p>I'm testing a Remote File Inclusion, for which I would expect my query to be blocked by the WAF. Unfortunately, my request still goes through. My query is <code>GET https://api.{mywebsite}.com/?test=https%3A%2F%2Fraw.githubusercontent.com%2Fmarcocesarato%2FPHP-Malware-Collection%2Fmaster%2Fclassic%2Fsimattacker.php</code>, so a simple GET query to <code>https://api.{mywebsite}.com</code> with a query parameter <code>test=https://raw.githubusercontent.com/marcocesarato/PHP-Malware-Collection/master/classic/simattacker.php</code></p><p>I enabled the log for the WAF, here you can see that my query is not block, despite the RFI present.</p><pre><code>{ "timestamp": 1697798175056, "formatVersion": 1, "webaclId": "arn:aws:wafv2:us-east-1:249461922481:global/webacl/waf-demo/ce82b689-0a46-4018-a992-80f6d03a1ca3", "terminatingRuleId": "Default_Action", "terminatingRuleType": "REGULAR", "action": "ALLOW", "terminatingRuleMatchDetails": [], "httpSourceName": "CF", "httpSourceId": "E2HC5UK2JK9WVG", "ruleGroupList": [ { "ruleGroupId": "AWS#AWSManagedRulesPHPRuleSet", "terminatingRule": null, "nonTerminatingMatchingRules": [], "excludedRules": null, "customerConfig": null }, { "ruleGroupId": "AWS#AWSManagedRulesLinuxRuleSet", "terminatingRule": null, "nonTerminatingMatchingRules": [], "excludedRules": null, "customerConfig": null }, { "ruleGroupId": "AWS#AWSManagedRulesKnownBadInputsRuleSet", "terminatingRule": null, "nonTerminatingMatchingRules": [], "excludedRules": null, "customerConfig": null }, { "ruleGroupId": "AWS#AWSManagedRulesCommonRuleSet", "terminatingRule": null, "nonTerminatingMatchingRules": [], "excludedRules": null, "customerConfig": null }, { "ruleGroupId": "AWS#AWSManagedRulesUnixRuleSet", "terminatingRule": null, "nonTerminatingMatchingRules": [], "excludedRules": null, "customerConfig": null }, { "ruleGroupId": "AWS#AWSManagedRulesSQLiRuleSet", "terminatingRule": null, "nonTerminatingMatchingRules": [], "excludedRules": null, "customerConfig": null } ], "rateBasedRuleList": [ { "rateBasedRuleId": "arn:aws:wafv2:us-east-1:249461922481_MANAGED:global/ipset/ce82b689-0a46-4018-a992-80f6d03a1ca3_d03fd8aa-b178-4da6-9da3-1b3a6511b176_IPV4/d03fd8aa-b178-4da6-9da3-1b3a6511b176", "rateBasedRuleName": "limit", "limitKey": "IP", "maxRateAllowed": 100, "limitValue": "{redacted}" } ], "nonTerminatingMatchingRules": [], "requestHeadersInserted": null, "responseCodeSent": null, "httpRequest": { "clientIp": "213.49.129.107", "country": "BE", "headers": [ { "name": "host", "value": "api.{mywebsite}.com" }, { "name": "user-agent", "value": "insomnia/8.3.0" }, { "name": "accept", "value": "*/*" }, { "name": "content-length", "value": "0" } ], "uri": "/", "args": "test=https%3A%2F%2Fraw.githubusercontent.com%2Fmarcocesarato%2FPHP-Malware-Collection%2Fmaster%2Fclassic%2Fsimattacker.php", "httpVersion": "HTTP/2.0", "httpMethod": "GET", "requestId": "45Jf2TK56hWIioDaQJgDVDFVgUVmULWq2OqRMbhmPQjXQW8lFYMNrA==" }, "ja3Fingerprint": "4ea056e63b7910cbf543f0c095064dfe" } </code></pre><p>Could you help me understand what happens ? Thanks</p><span class=d-none itemprop=commentCount></span> Related questions <a href=# class="p12 d-flex ai-center">1222 How does the SQL injection from the "Bobby Tables" XKCD comic work?</a> <a href=# class="p12 d-flex ai-center">0 AWS WAF with cloudfront</a> <a href=# class="p12 d-flex ai-center">0 Cloudfront distribution does not enforce TLS settings for Gateway API</a> Related questions <a href=# class="p12 d-flex ai-center">1222 How does the SQL injection from the "Bobby Tables" XKCD comic work?</a> <a href=# class="p12 d-flex ai-center">0 AWS WAF with cloudfront</a> <a href=# class="p12 d-flex ai-center">0 Cloudfront distribution does not enforce TLS settings for Gateway API</a> <a href=# class="p12 d-flex ai-center">355 How does Content Security Policy (CSP) work?</a> <a href=# class="p12 d-flex ai-center">0 Turning on AWS WAF geolocation restriction</a> <a href=# class="p12 d-flex ai-center">0 How do recent updates on AWS WAF Managed Core Rule Set work</a> <a class=s-link id=inline_related_see_more onclick=toggleInlineRelated(!0) href=#>Load 3 more related questions</a> <a class="s-link d-none" id=inline_related_see_less onclick=toggleInlineRelated(!1) href=#>Show fewer related questions</a><h2 class=mb0 data-answercount=0></h2>Sorted by: <a class="js-sort-preference-change s-link flex--item fs-fine d-none" data-value=ScoreDesc href=#>Reset to default</a><h2 class="bottom-notice bottom-share-links" style=padding-top:8px;margin-bottom:-8px>Know someone who can answer? Share a link to this <a href=#>question</a> via <a href=#>email</a>, <a href=#>Twitter</a>, or <a href=#>Facebook</a>.</h2><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJobnBrY2WAcYSOmq6sZaeWs26%2B1KWcZpmnqLqiusCgnJ2qpaGytK%2FOpqSopqKquaa%2FxK1knaeVqHqvu9Nmqp6dnWLBsHnWqKmkZaCnvLGx0aWw</p></section></article></main></div><footer><div class=container><span class=copyright>&copy; 2024 JadeVlog - <a rel=license href=http://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a></span></div></footer><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>